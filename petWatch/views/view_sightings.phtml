<?php global $search;
include 'template/header.phtml'; ?>

    <div class="row">
        <div class="col-md-12">
            <h2 class="text-center">My Reported Sightings</h2>

            <!-- Error message display -->
            <?php if (isset($error_message) && $error_message): ?>
                <div class="alert alert-danger">
                    <?php echo htmlspecialchars($error_message); ?>
                </div>
            <?php endif; ?>

            <!-- Success message display -->
            <?php if (isset($success_message) && $success_message): ?>
                <div class="alert alert-success">
                    <?php echo htmlspecialchars($success_message); ?>
                </div>
            <?php endif; ?>

            <!-- Search Form -->
            <div class="well">
                <form method="get" action="view_sightings.php" class="form-inline">
                    <div class="form-group" style="width: 80%;">
                        <input type="text" class="form-control" name="search" placeholder="Search in name, description, comment, location, timestamp..."
                               value="<?php echo htmlspecialchars($search); ?>" style="width: 100%;">
                    </div>
                    <button type="submit" class="btn btn-primary">Search</button>
                    <button type="button" class="btn btn-default" onclick="confirmClearSearch()">Clear</button>
                </form>
            </div>

            <!-- Sightings List -->
            <?php if (empty($userSightings)): ?>
                <!-- No sightings message -->
                <div class="alert alert-info text-center">
                    <?php if (!empty($search)): ?>
                        No sightings found matching your search criteria.
                    <?php else: ?>
                        You haven't reported any sightings yet.
                    <?php endif; ?>
                </div>
            <?php else: ?>
                <div class="row">
                    <?php foreach ($userSightings as $sighting): ?>
                        <div class="col-md-6 col-lg-4">
                            <!-- Sighting card panel -->
                            <div class="panel panel-default" style="min-height: 400px;">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <?php echo htmlspecialchars($sighting['pet_name']); ?>
                                        <!-- Reward label -->
                                        <span class="label label-primary pull-right">
                                        Â£<?php echo number_format($sighting['reward'], 2); ?>
                                    </span>
                                    </h4>
                                </div>
                                <div class="panel-body">
                                    <!-- Pet Image -->
                                    <div class="text-center">
                                        <img src="../images/pet-image/<?php echo htmlspecialchars($sighting['photo_url']); ?>"
                                             alt="<?php echo htmlspecialchars($sighting['pet_name']); ?>"
                                             class="img-responsive" style="max-height: 150px; margin: 0 auto;"
                                             onerror="this.src='../images/pet-image/default-pet.png'">
                                    </div>

                                    <!-- Pet Details -->
                                    <div class="pet-details" style="margin-top: 15px;">
                                        <p><strong>Species:</strong> <?php echo htmlspecialchars($sighting['species']); ?></p>
                                        <p><strong>Breed:</strong> <?php echo htmlspecialchars($sighting['breed']); ?></p>
                                        <p><strong>Color:</strong> <?php echo htmlspecialchars($sighting['color']); ?></p>
                                        <p><strong>Description:</strong> <?php echo htmlspecialchars($sighting['description']); ?></p>
                                    </div>

                                    <!-- Sighting Details -->
                                    <div class="sighting-details" style="border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px;">
                                        <h5>Sighting Information:</h5>
                                        <p><strong>Comment:</strong> <?php echo htmlspecialchars($sighting['comment']); ?></p>
                                        <p><strong>Location:</strong> <?php echo htmlspecialchars($sighting['latitude'] . ', ' . $sighting['longitude']); ?></p>
                                        <p><strong>Time:</strong> <?php echo htmlspecialchars($sighting['timestamp']); ?></p>
                                    </div>

                                    <!-- Delete Button -->
                                    <div class="text-center" style="margin-top: 15px;">
                                        <a href="view_sightings.php?delete_id=<?php echo $sighting['id']; ?>"
                                           class="btn btn-danger btn-sm"
                                           onclick="return confirmDeleteSighting()">
                                            Delete Sighting
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>

            <!-- Navigation Buttons -->
            <div class="text-center" style="margin-top: 30px;">
                <a href="../index.php" class="btn btn-default">Home</a>
                <a href="help.php" class="btn btn-default">Help</a>
                <a href="report_sighting.php" class="btn btn-default">Report New Sighting</a>
            </div>
        </div>
    </div>

    <script>
        // Confirmation functions
        function confirmClearSearch() {
            if (confirm("Are you sure you want to clear the search?")) {
                window.location.href = 'view_sightings.php';
            }
        }

        function confirmDeleteSighting() {
            return confirm("Are you sure you want to delete this sighting? This action cannot be undone.");
        }
    </script>

<?php include 'template/footer.phtml'; ?>